[tox]
minversion = 3.1.1
envlist = py39, pep8, cover
ignore_basepython_conflict = True
skipsdist = True

[testenv]
usedevelop = True
basepython = python3
setenv =
   VIRTUAL_ENV={envdir}
   OS_TEST_PATH=./src/warmahordes_opendata/tests
deps =
       -r{toxinidir}/requirements.txt
       -r{toxinidir}/test-requirements.txt
commands =
    python setup.py compile_catalog
    stestr run --slowest {posargs}

[testenv:pep8]
commands =
  flake8

[testenv:cover]
setenv =
    PYTHON=coverage run --source src/warmahordes_opendata --parallel-mode
commands =
    coverage erase
    {[testenv]commands}
    coverage combine
    coverage html -d cover
    coverage xml -o cover/coverage.xml
    coverage report --show-missing

[flake8]
# [H106] Don't put vim configuration in source files.
# [H203] Use assertIs(Not)None to check for None.
show-source = True
exclude=.venv,.git,.tox,dist,doc,*lib/python*,*egg,build
enable-extensions = H106,H203

[travis]
python = 3.9: py39, pep8, cover
